{"version":3,"file":"index.mjs","sources":["../src/hooks/useWalletBalance.ts","../src/hooks/useWalletUtxos.ts","../src/hooks/useSendTransaction.ts","../src/components/TransactionCreatorWithData.tsx"],"sourcesContent":["import { useQuery, UseQueryResult } from '@tanstack/react-query';\r\nimport { WalletInterface, Assets } from '@clan/framework-core';\r\n\r\nexport interface UseWalletBalanceOptions {\r\n  refetchInterval?: number;\r\n  enabled?: boolean;\r\n}\r\n\r\n/**\r\n * React Query hook for fetching and caching wallet balance\r\n * @param wallet - Wallet instance implementing WalletInterface\r\n * @param options - Configuration options\r\n * @returns React Query result with balance data\r\n */\r\nexport const useWalletBalance = (\r\n  wallet: WalletInterface,\r\n  options: UseWalletBalanceOptions = {}\r\n): UseQueryResult<Assets, Error> => {\r\n  const { refetchInterval = 10000, enabled = true } = options;\r\n  const walletId = wallet.getName(); // Derive from wallet\r\n\r\n  return useQuery({\r\n    queryKey: ['wallet', walletId, 'balance'],\r\n    queryFn: async () => {\r\n      return await wallet.getBalance();\r\n    },\r\n    refetchInterval,\r\n    enabled,\r\n  });\r\n};\r\n\r\n","import { useQuery, UseQueryResult } from '@tanstack/react-query';\r\nimport { WalletInterface, UTxO } from '@clan/framework-core';\r\n\r\nexport interface UseWalletUtxosOptions {\r\n  refetchInterval?: number;\r\n  enabled?: boolean;\r\n}\r\n\r\n/**\r\n * React Query hook for fetching and caching wallet UTXOs\r\n * @param wallet - Wallet instance implementing WalletInterface\r\n * @param options - Configuration options\r\n * @returns React Query result with UTXOs array\r\n */\r\nexport const useWalletUtxos = (\r\n  wallet: WalletInterface,\r\n  options: UseWalletUtxosOptions = {}\r\n): UseQueryResult<UTxO[], Error> => {\r\n  const { refetchInterval = 10000, enabled = true } = options;\r\n  const walletId = wallet.getName(); // Derive from wallet\r\n\r\n  return useQuery({\r\n    queryKey: ['wallet', walletId, 'utxos'],\r\n    queryFn: async () => {\r\n      return await wallet.getUtxos();\r\n    },\r\n    refetchInterval,\r\n    enabled,\r\n  });\r\n};\r\n\r\n","import { useMutation, useQueryClient, UseMutationResult } from '@tanstack/react-query';\nimport { WalletInterface } from '@clan/framework-core';\n\nexport interface SendTransactionParams {\n  recipientAddress: string;\n  assets: Record<string, bigint>;\n  options?: any;\n}\n\nexport interface SendTransactionResult {\n  txHash: string;\n  draft: any;\n  signedTx: any;\n}\n\nexport interface UseSendTransactionOptions {\n  onSuccess?: (data: SendTransactionResult) => void;\n  onError?: (error: Error) => void;\n}\n\n/**\n * React Query mutation hook for sending transactions\n * Automatically invalidates balance, UTXOs, and transaction cache on success\n * @param wallet - Wallet instance implementing WalletInterface\n * @param options - Configuration options\n * @returns React Query mutation result\n */\nexport const useSendTransaction = (\n  wallet: WalletInterface,\n  options: UseSendTransactionOptions = {}\n): UseMutationResult<SendTransactionResult, Error, SendTransactionParams> => {\n  const { onSuccess, onError } = options;\n  const walletId = wallet.getName(); // Derive from wallet\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({ recipientAddress, assets, options: txOptions }: SendTransactionParams) => {\n      // Create transaction draft\n      const draft = await wallet.createTransaction(\n        [{ address: recipientAddress, assets }],\n        txOptions\n      );\n\n      // Sign transaction\n      const signedTx = await wallet.signTransaction(draft);\n\n      // Submit to blockchain\n      const txHash = await wallet.submitTransaction(signedTx);\n\n      return { txHash, draft, signedTx };\n    },\n\n    onSuccess: (data) => {\n      // Automatically invalidate related queries to trigger refetch\n      queryClient.invalidateQueries({ queryKey: ['wallet', walletId, 'balance'] });\n      queryClient.invalidateQueries({ queryKey: ['wallet', walletId, 'utxos'] });\n      queryClient.invalidateQueries({ queryKey: ['wallet', walletId, 'transactions'] });\n\n      // Call custom success handler\n      onSuccess?.(data);\n    },\n\n    onError: (error: Error) => {\n      // Call custom error handler\n      onError?.(error);\n    },\n  });\n};\n\n","import React, { useState, useEffect } from 'react';\nimport { WalletInterface } from '@clan/framework-core';\nimport type { TransactionBuildOptions } from '@clan/framework-core';\nimport { \n  TransactionCreator, \n  UIAsset,\n  convertAssetsToAssetArray,\n  convertAssetsToAssetArraySync \n} from '@clan/framework-components';\nimport { useWalletBalance } from '../hooks/useWalletBalance';\nimport { useWalletUtxos } from '../hooks/useWalletUtxos';\n\n/**\n * Token metadata provider interface for enriching assets with metadata\n * Compatible with future BroClan metadata provider integration\n */\nexport interface TokenMetadataProvider {\n  getMetadata(assetId: string): Promise<Partial<Omit<UIAsset, 'id' | 'balance'>>>;\n}\n\nexport interface TransactionCreatorWithDataProps {\n  wallet: WalletInterface;\n  metadataProvider?: TokenMetadataProvider;\n  onTransactionCreated?: (options: TransactionBuildOptions) => void;\n  onCancel?: () => void;\n  className?: string;\n  refetchInterval?: number;\n}\n\n/**\n * Smart wrapper around TransactionCreator that automatically fetches wallet data\n * \n * @example\n * // Simple usage (no metadata)\n * <TransactionCreatorWithData \n *   wallet={wallet}\n *   onTransactionCreated={(tx) => console.log('Created!', tx)}\n * />\n * \n * @example\n * // With metadata provider (BroClan integration)\n * <TransactionCreatorWithData \n *   wallet={wallet}\n *   metadataProvider={broClanMetadataProvider}\n *   onTransactionCreated={(tx) => console.log('Created!', tx)}\n * />\n */\nexport const TransactionCreatorWithData: React.FC<TransactionCreatorWithDataProps> = ({\n  wallet,\n  metadataProvider,\n  refetchInterval = 10000,\n  ...props\n}) => {\n  const [availableAssets, setAvailableAssets] = useState<UIAsset[]>([]);\n  const [isEnrichingAssets, setIsEnrichingAssets] = useState(false);\n\n  // Auto-fetch wallet data with React Query\n  const { data: balance, isLoading: balanceLoading, error: balanceError } = useWalletBalance(wallet, {\n    refetchInterval,\n    enabled: true\n  });\n\n  const { data: utxos, isLoading: utxosLoading, error: utxosError } = useWalletUtxos(wallet, {\n    refetchInterval,\n    enabled: true\n  });\n\n  // Convert balance to Asset[] format with optional metadata enrichment\n  useEffect(() => {\n    if (!balance) return;\n\n    const enrichAssets = async () => {\n      setIsEnrichingAssets(true);\n      try {\n        if (metadataProvider) {\n          // Async enrichment with metadata provider\n          const enrichedAssets = await convertAssetsToAssetArray(\n            balance,\n            async (assetId) => {\n              try {\n                return await metadataProvider.getMetadata(assetId);\n              } catch (error) {\n                console.warn(`Failed to fetch metadata for ${assetId}:`, error);\n                return {};\n              }\n            }\n          );\n          setAvailableAssets(enrichedAssets);\n        } else {\n          // Sync conversion without metadata\n          const basicAssets = convertAssetsToAssetArraySync(balance);\n          setAvailableAssets(basicAssets);\n        }\n      } catch (error) {\n        console.error('Error enriching assets:', error);\n        // Fallback to basic assets\n        setAvailableAssets(convertAssetsToAssetArraySync(balance));\n      } finally {\n        setIsEnrichingAssets(false);\n      }\n    };\n\n    enrichAssets();\n  }, [balance, metadataProvider]);\n\n  // Loading state\n  if (balanceLoading || utxosLoading) {\n    return (\n      <div className=\"transaction-creator-loading\" style={{ padding: '2rem', textAlign: 'center' }}>\n        <div>Loading wallet data...</div>\n      </div>\n    );\n  }\n\n  // Error state\n  if (balanceError || utxosError) {\n    return (\n      <div className=\"transaction-creator-error\" style={{ padding: '2rem', color: '#ef4444' }}>\n        <div>Error loading wallet data</div>\n        {balanceError && <div>{balanceError.message}</div>}\n        {utxosError && <div>{utxosError.message}</div>}\n      </div>\n    );\n  }\n\n  // No UTXOs available\n  if (!utxos || utxos.length === 0) {\n    return (\n      <div className=\"transaction-creator-no-utxos\" style={{ padding: '2rem', textAlign: 'center' }}>\n        <div>No funds available in wallet</div>\n      </div>\n    );\n  }\n\n  return (\n    <TransactionCreator\n      wallet={wallet}\n      availableUtxos={utxos}\n      availableAssets={availableAssets}\n      {...props}\n    />\n  );\n};\n\n"],"names":["useWalletBalance","wallet","options","refetchInterval","enabled","walletId","useQuery","useWalletUtxos","useSendTransaction","onSuccess","onError","queryClient","useQueryClient","useMutation","recipientAddress","assets","txOptions","draft","signedTx","data","error","TransactionCreatorWithData","metadataProvider","props","availableAssets","setAvailableAssets","useState","isEnrichingAssets","setIsEnrichingAssets","balance","balanceLoading","balanceError","utxos","utxosLoading","utxosError","useEffect","enrichedAssets","convertAssetsToAssetArray","assetId","basicAssets","convertAssetsToAssetArraySync","jsx","jsxs","TransactionCreator"],"mappings":"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"}