"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const y=require("@tanstack/react-query"),c=require("react/jsx-runtime"),v=require("react"),x=require("@clan/framework-components"),b=(e,s={})=>{const{refetchInterval:t=1e4,enabled:i=!0}=s,a=e.getName();return y.useQuery({queryKey:["wallet",a,"balance"],queryFn:async()=>await e.getBalance(),refetchInterval:t,enabled:i})},D=(e,s={})=>{const{refetchInterval:t=1e4,enabled:i=!0}=s,a=e.getName();return y.useQuery({queryKey:["wallet",a,"utxos"],queryFn:async()=>await e.getUtxos(),refetchInterval:t,enabled:i})},Q=(e,s={})=>{const{onSuccess:t,onError:i}=s,a=e.getName(),r=y.useQueryClient();return y.useMutation({mutationFn:async({recipientAddress:n,assets:d,options:l})=>{const u=await e.createTransaction([{address:n,assets:d}],l),g=await e.signTransaction(u);return{txHash:await e.submitTransaction(g),draft:u,signedTx:g}},onSuccess:n=>{r.invalidateQueries({queryKey:["wallet",a,"balance"]}),r.invalidateQueries({queryKey:["wallet",a,"utxos"]}),r.invalidateQueries({queryKey:["wallet",a,"transactions"]}),t==null||t(n)},onError:n=>{i==null||i(n)}})},q=(e,s={})=>{const{onSuccess:t,onError:i}=s,a=e.getName(),r=y.useQueryClient();return y.useMutation({mutationFn:async({poolId:n})=>{if(!e.createDelegationTransaction)throw new Error("Wallet does not support delegation transactions");const d=await e.createDelegationTransaction(n),l=await e.signTransaction(d);return{txHash:await e.submitTransaction(l),poolId:n}},onSuccess:n=>{r.invalidateQueries({queryKey:["wallet",a,"balance"]}),r.invalidateQueries({queryKey:["wallet",a,"delegation"]}),r.invalidateQueries({queryKey:["wallet",a,"transactions"]}),t==null||t(n)},onError:n=>{i==null||i(n)}})},W=(e,s={})=>{const{refetchInterval:t=3e4,enabled:i=!0}=s,a=e.getName();return y.useQuery({queryKey:["wallet",a,"delegation"],queryFn:async()=>{if(e.getDelegationInfo)return await e.getDelegationInfo()},refetchInterval:t,enabled:i})},T=(e,s={})=>{const{onSuccess:t,onError:i}=s,a=e.getName(),r=y.useQueryClient();return y.useMutation({mutationFn:async()=>{if(!e.withdrawRewards)throw new Error("Wallet does not support reward withdrawal");const n=e.getDelegationInfo?await e.getDelegationInfo():void 0,d=(n==null?void 0:n.rewards)||0n,l=await e.withdrawRewards(),u=await e.signTransaction(l);return{txHash:await e.submitTransaction(u),amount:d}},onSuccess:n=>{r.invalidateQueries({queryKey:["wallet",a,"balance"]}),r.invalidateQueries({queryKey:["wallet",a,"delegation"]}),r.invalidateQueries({queryKey:["wallet",a,"transactions"]}),t==null||t(n)},onError:n=>{i==null||i(n)}})},I=({wallet:e,metadataProvider:s,refetchInterval:t=1e4,...i})=>{const[a,r]=v.useState([]),[n,d]=v.useState(!1),{data:l,isLoading:u,error:g}=b(e,{refetchInterval:t,enabled:!0}),{data:h,isLoading:m,error:w}=D(e,{refetchInterval:t,enabled:!0});return v.useEffect(()=>{if(!l)return;(async()=>{d(!0);try{if(s){const f=await x.convertAssetsToAssetArray(l,async A=>{try{return await s.getMetadata(A)}catch(p){return console.warn(`Failed to fetch metadata for ${A}:`,p),{}}});r(f)}else{const f=x.convertAssetsToAssetArraySync(l);r(f)}}catch(f){console.error("Error enriching assets:",f),r(x.convertAssetsToAssetArraySync(l))}finally{d(!1)}})()},[l,s]),u||m?c.jsx("div",{className:"transaction-creator-loading",style:{padding:"2rem",textAlign:"center"},children:c.jsx("div",{children:"Loading wallet data..."})}):g||w?c.jsxs("div",{className:"transaction-creator-error",style:{padding:"2rem",color:"#ef4444"},children:[c.jsx("div",{children:"Error loading wallet data"}),g&&c.jsx("div",{children:g.message}),w&&c.jsx("div",{children:w.message})]}):!h||h.length===0?c.jsx("div",{className:"transaction-creator-no-utxos",style:{padding:"2rem",textAlign:"center"},children:c.jsx("div",{children:"No funds available in wallet"})}):c.jsx(x.TransactionCreator,{wallet:e,availableUtxos:h,availableAssets:a,...i})},j=({wallet:e,onSuccess:s,onError:t,className:i})=>{const{data:a,isLoading:r}=W(e,{refetchInterval:3e4,enabled:!0}),{mutateAsync:n,isPending:d}=q(e,{onSuccess:o=>{console.log("Delegation successful:",o),s==null||s("delegate",o)},onError:o=>{console.error("Delegation failed:",o),t==null||t(o)}}),{mutateAsync:l,isPending:u}=T(e,{onSuccess:o=>{console.log("Withdrawal successful:",o),s==null||s("withdraw",o)},onError:o=>{console.error("Withdrawal failed:",o),t==null||t(o)}}),g=a?{stakeAddress:a.stakeAddress,delegatedPool:a.delegatedPool,rewards:a.rewards,activeEpoch:a.activeEpoch,nextRewardEpoch:a.nextRewardEpoch}:void 0,h=async o=>{await n({poolId:o})},m=async()=>{console.log("Undelegate not yet implemented"),t==null||t(new Error("Undelegate functionality not yet implemented"))},w=async()=>{await l()};return r?c.jsx("div",{className:"delegation-loading",children:"Loading delegation info..."}):c.jsx(x.WalletDelegation,{wallet:e,delegationInfo:g,onDelegate:h,onUndelegate:m,onWithdrawRewards:w,isDelegating:d,isWithdrawing:u,className:i})};exports.TransactionCreatorWithData=I;exports.WalletDelegationWithData=j;exports.useDelegateStake=q;exports.useSendTransaction=Q;exports.useWalletBalance=b;exports.useWalletDelegation=W;exports.useWalletUtxos=D;exports.useWithdrawRewards=T;
//# sourceMappingURL=index.js.map
