"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const l=require("@tanstack/react-query"),y=require("react/jsx-runtime"),h=require("@clan/framework-components"),v=(e,s={})=>{const{refetchInterval:t=1e4,enabled:i=!0}=s,a=e.getName();return l.useQuery({queryKey:["wallet",a,"balance"],queryFn:async()=>await e.getBalance(),refetchInterval:t,enabled:i})},T=(e,s={})=>{const{refetchInterval:t=1e4,enabled:i=!0}=s,a=e.getName();return l.useQuery({queryKey:["wallet",a,"utxos"],queryFn:async()=>await e.getUtxos(),refetchInterval:t,enabled:i})},Q=(e,s={})=>{const{onSuccess:t,onError:i}=s,a=e.getName(),o=l.useQueryClient();return l.useMutation({mutationFn:async({recipientAddress:n,assets:d,options:u})=>{const c=await e.createTransaction([{address:n,assets:d}],u),g=await e.signTransaction(c);return{txHash:await e.submitTransaction(g),draft:c,signedTx:g}},onSuccess:n=>{o.invalidateQueries({queryKey:["wallet",a,"balance"]}),o.invalidateQueries({queryKey:["wallet",a,"utxos"]}),o.invalidateQueries({queryKey:["wallet",a,"transactions"]}),t==null||t(n)},onError:n=>{i==null||i(n)}})},f=(e,s={})=>{const{onSuccess:t,onError:i}=s,a=e.getName(),o=l.useQueryClient();return l.useMutation({mutationFn:async({poolId:n})=>{if(!e.createDelegationTransaction)throw new Error("Wallet does not support delegation transactions");const d=await e.createDelegationTransaction(n),u=await e.signTransaction(d);return{txHash:await e.submitTransaction(u),poolId:n}},onSuccess:n=>{o.invalidateQueries({queryKey:["wallet",a,"balance"]}),o.invalidateQueries({queryKey:["wallet",a,"delegation"]}),o.invalidateQueries({queryKey:["wallet",a,"transactions"]}),t==null||t(n)},onError:n=>{i==null||i(n)}})},D=(e,s={})=>{const{refetchInterval:t=3e4,enabled:i=!0}=s,a=e.getName();return l.useQuery({queryKey:["wallet",a,"delegation"],queryFn:async()=>{if(e.getDelegationInfo)return await e.getDelegationInfo()},refetchInterval:t,enabled:i})},m=(e,s={})=>{const{onSuccess:t,onError:i}=s,a=e.getName(),o=l.useQueryClient();return l.useMutation({mutationFn:async()=>{if(!e.withdrawRewards)throw new Error("Wallet does not support reward withdrawal");const n=e.getDelegationInfo?await e.getDelegationInfo():void 0,d=(n==null?void 0:n.rewards)||0n,u=await e.withdrawRewards(),c=await e.signTransaction(u);return{txHash:await e.submitTransaction(c),amount:d}},onSuccess:n=>{o.invalidateQueries({queryKey:["wallet",a,"balance"]}),o.invalidateQueries({queryKey:["wallet",a,"delegation"]}),o.invalidateQueries({queryKey:["wallet",a,"transactions"]}),t==null||t(n)},onError:n=>{i==null||i(n)}})},b=({wallet:e,metadataProvider:s,...t})=>y.jsx(h.TransactionCreator,{wallet:e,metadataProvider:s,...t}),I=({wallet:e,onSuccess:s,onError:t,className:i})=>{const{data:a,isLoading:o}=D(e,{refetchInterval:3e4,enabled:!0}),{mutateAsync:n,isPending:d}=f(e,{onSuccess:r=>{console.log("Delegation successful:",r),s==null||s("delegate",r)},onError:r=>{console.error("Delegation failed:",r),t==null||t(r)}}),{mutateAsync:u,isPending:c}=m(e,{onSuccess:r=>{console.log("Withdrawal successful:",r),s==null||s("withdraw",r)},onError:r=>{console.error("Withdrawal failed:",r),t==null||t(r)}}),g=a?{stakeAddress:a.stakeAddress,delegatedPool:a.delegatedPool,delegatedDRep:a.delegatedDRep,rewards:a.rewards,nextRewardEpoch:a.nextRewardEpoch}:void 0,w=async(r,x)=>{r&&await n({poolId:r}),console.log("Delegation requested - Pool:",r,"dRep:",x)},q=async()=>{console.log("Undelegate not yet implemented"),t==null||t(new Error("Undelegate functionality not yet implemented"))},W=async()=>{await u()};return o?y.jsx("div",{className:"delegation-loading",children:"Loading delegation info..."}):y.jsx(h.WalletDelegation,{wallet:e,delegationInfo:g,onDelegate:w,onUndelegate:q,onWithdrawRewards:W,isDelegating:d,isWithdrawing:c,className:i})};exports.TransactionCreatorWithData=b;exports.WalletDelegationWithData=I;exports.useDelegateStake=f;exports.useSendTransaction=Q;exports.useWalletBalance=v;exports.useWalletDelegation=D;exports.useWalletUtxos=T;exports.useWithdrawRewards=m;
//# sourceMappingURL=index.js.map
